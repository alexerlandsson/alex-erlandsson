/* ======================
   Global variables
====================== */

:root {
  color-scheme: light dark;

  /* Base */
  --gutter: 1.5rem;
  --font-family: ui-monospace, "Cascadia Code", "Source Code Pro", menlo, consolas, "DejaVu Sans Mono", monospace;

  /* Colors */
  --color-bg: #e9e6e2;
  --color-fg: #000;
  --color-link-bg: #fff;
  --color-link-bg-mix: #000;
  --color-focus: #3b82f6;
  --color-hair: #5c2f13;
  --color-tshirt: #0e1d32;
  --color-trousers: #1e3f98;
  --color-shoes-top: #7a7873;
  --color-shoes-bottom: #fff;
  --color-skin: #d6b098;
  --color-speak-bubble-bg: #fff;
  --color-speak-bubble-fg: #000;

  @media (prefers-contrast: more) {
    --color-tshirt: #000;
  }

  @media (prefers-color-scheme: dark) {
    --color-bg: #000;
    --color-fg: #fff;
    --color-link-bg: #191919;
    --color-link-bg-mix: #fff;

    @media (prefers-contrast: more) {
      --color-tshirt: #fff;
    }
  }
}

/* ======================
   Global styles
====================== */

*,
*::before,
*::after {
  box-sizing: border-box;
}

html,
body {
  height: 100dvh;
  overscroll-behavior: none;
  touch-action: none;
  overflow: hidden;
}

html {
  font-size: 100%;
  text-size-adjust: 100%;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

body {
  margin: 0;
  background-color: var(--color-bg);
  color: var(--color-fg);
  font-family: var(--font-family);
  font-size: 1rem;
  user-select: none;
}

/* ======================
   Utilities
====================== */

.sr-only {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  border: 0;
}

.icon {
  display: block;
  width: 1em;
  height: 1em;
  stroke: currentColor;
  stroke-width: 2;
}

/* ======================
   Root
====================== */

.root {
  display: flex;
  flex-direction: column;
  height: 100%;
}

/* ======================
   Footer
====================== */

@keyframes footer-animate-in {
  0%,
  20% {
    transform: translateY(100%);
  }

  100% {
    transform: translateY(0);
  }
}

.footer {
  flex-shrink: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  padding-block-end: var(--gutter);
  padding-inline: var(--gutter);
  z-index: 1;

  @media not (prefers-reduced-motion: reduce) {
    animation: footer-animate-in 1500ms linear(0, 1.25, 1, 0.9, 1.04, 0.99, 1.005, 0.996, 1.001, 0.999, 1);
  }

  @media (width <= 30rem) {
    padding-block-end: calc(var(--gutter) * 0.5);
  }
}

.footer__nav-list {
  display: flex;
  justify-content: center;
  align-items: center;
  flex-wrap: wrap;
  gap: 0.25rem;
  list-style: none;
  padding: 0;
  margin: 0;
}

.footer__nav-action {
  display: block;
  padding: 0.5rem 0.75rem;
  background-color: var(--color-link-bg);
  border-radius: 0.25rem;
  color: currentColor;
  text-decoration: none;
  font-size: 0.875rem;
  transition: transform 200ms ease-in-out;

  &:is(button) {
    margin: 0;
    border: none;
    font-family: var(--font-family);
    font-weight: inherit;
    cursor: pointer;
  }

  &:hover {
    background-color: color-mix(in oklab, var(--color-link-bg) 95%, var(--color-link-bg-mix) 5%);
  }

  &:active {
    transform: scale(0.95);
  }
}

.footer__nav-action--icon {
  display: flex;
  align-items: center;
  gap: 0.25ch;
}

/* ======================
   Main
====================== */

.main {
  flex: 1 1 auto;
  display: flex;
  align-items: center;
  justify-content: center;
  height: 100%;
}

/* ======================
   Scene
====================== */

.scene {
  --canvas-base-unit: min(1rem, 2.5vh);
  --canvas-width: 7;
  --canvas-height: 23;
  --canvas-depth: 5;
  --_canvas-width: calc(var(--canvas-width) * var(--canvas-base-unit));
  --_canvas-height: calc(var(--canvas-height) * var(--canvas-base-unit));
  --_canvas-depth: calc(var(--canvas-depth) * var(--canvas-base-unit));

  width: var(--_canvas-width);
  height: var(--_canvas-height);
  perspective: 32rem;
  user-select: none;
  cursor: grab;

  &:active {
    cursor: grabbing;
  }
}

/* ======================
   Canvas
====================== */

@keyframes canvas-animate-in {
  to {
    transform: rotateY(1turn);
  }
}

.canvas {
  position: relative;
  width: 100%;
  height: 100%;
  transform-style: preserve-3d;
  translate: 0 0 calc(var(--_canvas-depth) * -0.5);
  margin: 0;

  @media not (prefers-reduced-motion: reduce) {
    animation: canvas-animate-in 1500ms linear(0, 1.25, 1, 0.9, 1.04, 0.99, 1.005, 0.996, 1.001, 0.999, 1);
  }
}

/* ======================
   Cuboid
====================== */

.cuboid,
.cuboid__inner {
  position: absolute;
  transform-style: inherit;
  width: var(--_w);
  height: var(--_h);
  background-color: var(--_c);

  &::before,
  &::after {
    content: "";
    position: inherit;
    background-color: inherit;
  }
}

/* Cuboid Side: Back */
.cuboid {
  --_w: calc(var(--w, 1) * var(--canvas-base-unit)); /* Width */
  --_h: calc(var(--h, 1) * var(--canvas-base-unit)); /* Height */
  --_d: calc(var(--d, 1) * var(--canvas-base-unit)); /* Depth */
  --_x: calc(var(--x, 0) * var(--canvas-base-unit)); /* Pos X */
  --_y: calc(var(--y, 0) * var(--canvas-base-unit)); /* Pos Y */
  --_z: calc(var(--z, 0) * var(--canvas-base-unit)); /* Pos Z */
  --_c: var(--c); /* Color */

  transform: translate3d(var(--_x), var(--_y), calc(var(--_canvas-depth) * 0.5 - var(--_z) - var(--_d)));
}

/* Cuboid Side: Left & Right */
.cuboid::before,
.cuboid::after {
  width: var(--_d);
  height: var(--_h);
  left: calc(var(--_w) * 0.5 - var(--_d) * 0.5);
}

/* Cuboid Side: Left */
.cuboid::before {
  transform: rotateY(90deg) translateZ(calc(var(--_w) * 0.5)) translateX(-50%);
}

/* Cuboid Side: Right */
.cuboid::after {
  transform: rotateY(-90deg) translateZ(calc(var(--_w) * 0.5)) translateX(50%);
}

/* Cuboid Side: Front */
.cuboid__inner {
  transform: translateZ(var(--_d));
}

/* Cuboid Side: Top & Bottom */
.cuboid__inner::before,
.cuboid__inner::after {
  width: var(--_w);
  height: var(--_d);
  top: calc(var(--_h) * 0.5 - var(--_d) * 0.5);
}

/* Cuboid Side: Top */
.cuboid__inner::before {
  transform: rotateX(90deg) translateZ(calc(var(--_h) * 0.5)) translateY(-50%);
}

/* Cuboid Side: Bottom */
.cuboid__inner::after {
  transform: rotateX(-90deg) translateZ(calc(var(--_h) * 0.5)) translateY(50%);
}

/* ======================
   Dialog
====================== */

@keyframes dialog-open {
  from {
    opacity: 0;
    transform: scale(0.95);
  }

  to {
    opacity: 1;
    transform: scale(1);
  }
}

@keyframes dialog-close {
  from {
    opacity: 1;
    transform: scale(1);
  }

  to {
    opacity: 0;
    transform: scale(0.95);
  }
}

.dialog {
  --_dialog-bg: var(--color-bg);
  --_dialog-fg: var(--color-fg);
  --_dialog-padding: 1rem;
  --_dialog-animation-duration: 150ms;

  width: 600px;
  max-height: calc(100dvh - var(--gutter) * 2);
  max-width: calc(100dvw - var(--gutter) * 2);
  padding: 0;
  background-color: var(--_dialog-bg);
  color: var(--_dialog-fg);
  border: 1px solid currentColor;

  &::backdrop {
    background-color: transparent;
  }

  @media not (prefers-reduced-motion: reduce) {
    &[open] {
      animation: dialog-open var(--_dialog-animation-duration) ease-out;
    }

    &.dialog--closing {
      animation: dialog-close var(--_dialog-animation-duration) ease-in forwards;
    }
  }
}

.dialog__header {
  position: sticky;
  top: 0;
  z-index: 1;
  display: flex;
  align-items: center;
  justify-content: space-between;
  background-color: var(--_dialog-bg);
  border-bottom: 1px solid;
  cursor: move;
}

.dialog__title {
  margin-block: 0;
  padding-inline: var(--_dialog-padding);
  font-size: 1rem;
  font-weight: inherit;
  user-select: none;
}

.dialog__close {
  --focus-outline-offset: -2px;

  align-self: stretch;
  aspect-ratio: 1;
  background-color: transparent;
  color: var(--_dialog-fg);
  padding: calc(var(--_dialog-padding) * 0.5);
  margin: 0;
  border: none;
  border-left: 1px solid;
  border-radius: 0;
  font-size: 1em;
  font-family: var(--font-family);
  cursor: pointer;

  &:enabled {
    &:hover {
      background-color: var(--_dialog-fg);
      color: var(--_dialog-bg);
    }
  }
}

.dialog__close-icon {
  display: block;
  width: 1em;
  height: 1em;
}

.dialog__body {
  padding: var(--_dialog-padding);
  overflow: auto;
}

.dialog__paragraph {
  margin-block: 0;
  font-size: 1rem;

  & + & {
    margin-block-start: 1lh;
  }
}

/* ======================
   Avatar
====================== */

/* Avatar: Hair */

.avatar__hair {
  --c: var(--color-hair);
}

.avatar__hair--top {
  --w: 2;
  --h: 1;
  --d: 3;
  --x: 2;
  --y: 0;
  --z: 1;
}

.avatar__hair--middle {
  --w: 5;
  --h: 1;
  --d: 4;
  --x: 1;
  --y: 1;
  --z: 1;
}

.avatar__hair--back {
  --w: 5;
  --h: 2;
  --d: 2;
  --x: 1;
  --y: 2;
  --z: 3;
}

/* Avatar: Face */

.avatar__face {
  --c: var(--color-skin);
}

.avatar__face--nose {
  --w: 1;
  --h: 1;
  --d: 1;
  --x: 3;
  --y: 3;
  --z: 0;
}

.avatar__face--front {
  --w: 3;
  --h: 4;
  --d: 1;
  --x: 2;
  --y: 2;
  --z: 2;
}

.avatar__face--middle {
  --w: 3;
  --h: 3;
  --d: 1;
  --x: 2;
  --y: 2;
  --z: 1;
}

.avatar__face--back {
  --w: 3;
  --h: 2;
  --d: 1;
  --x: 2;
  --y: 4;
  --z: 3;
}

/* Avatar: Arm */

.avatar__arm {
  --w: 1;
  --h: 5;
  --d: 2;
  --y: 9;
  --z: 2;
  --c: var(--color-skin);
}

.avatar__arm--left {
  --x: 6;
}

.avatar__arm--right {
  --x: 0;
}

/* Avatar: T-shirt */

.avatar__tshirt {
  --c: var(--color-tshirt);
}

.avatar__tshirt--body {
  --w: 5;
  --h: 7;
  --d: 4;
  --x: 1;
  --y: 6;
  --z: 1;
}

.avatar__tshirt--arm {
  --w: 1;
  --h: 3;
  --d: 2;
  --y: 6;
  --z: 2;
}

.avatar__tshirt--arm-left {
  --x: 6;
}

.avatar__tshirt--arm-right {
  --x: 0;
}

/* Avatar: Trousers */

.avatar__trousers {
  --c: var(--color-trousers);
}

.avatar__trousers--waist {
  --w: 5;
  --h: 1;
  --d: 2;
  --x: 1;
  --y: 13;
  --z: 2;
}

.avatar__trousers--leg {
  --w: 2;
  --h: 7;
  --d: 2;
  --x: 4;
  --y: 14;
  --z: 2;
}

.avatar__trousers--leg-left {
  --x: 4;
}

.avatar__trousers--leg-right {
  --x: 1;
}

/* Avatar: Shoes */

.avatar__shoes {
  --w: 2;
  --h: 1;
  --d: 3;
  --z: 1;
}

.avatar__shoes--top {
  --y: 21;
  --c: var(--color-shoes-top);
}

.avatar__shoes--bottom {
  --y: 22;
  --c: var(--color-shoes-bottom);
}

.avatar__shoes--left {
  --x: 4;
}

.avatar__shoes--right {
  --x: 1;
}

/* Avatar: Speak Bubble */

.avatar__speak-bubble {
  --c: var(--color-speak-bubble-bg);
  --d: 1;
  --z: 2;
}

.avatar__speak-bubble--main {
  --w: 7;
  --h: 5;
  --x: 7;
  --y: -4;
}

.avatar__speak-bubble--angle {
  --w: 1;
  --y: 1;
}

.avatar__speak-bubble--angle-main {
  --h: 2;
  --x: 8;
}

.avatar__speak-bubble--angle-alt {
  --h: 1;
  --x: 9;
}

.avatar__speak-bubble--content {
  display: flex;
  align-items: center;
  justify-content: center;
  padding: var(--canvas-base-unit);
  margin: 0;
  color: var(--color-speak-bubble-fg);
  text-align: center;
  font-size: calc(var(--canvas-base-unit) * 0.75);
}

/* ======================
   Focus
====================== */

@supports selector(:focus-visible) {
  :where(a, button, input, select, textarea, summary, [role="button"]) {
    &:focus-visible {
      outline: 2px solid var(--color-focus);
      outline-offset: var(--focus-outline-offset, 2px);
    }
  }
}

@supports not selector(:focus-visible) {
  :where(a, button, input, select, textarea, summary, [role="button"]) {
    &:focus {
      outline: 2px solid var(--color-focus);
      outline-offset: var(--focus-outline-offset, 2px);
    }
  }
}
